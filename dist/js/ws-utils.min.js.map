{"version":3,"sources":["dist/js/ws-utils.js"],"names":["app","angular","module","directive","$timeout","restrict","link","scope","element","attributes","model","onTap","e","addClass","removeClass","addListeners","on","removeListeners","off","$on","animate","delays","undefined","split","delay","forEach","d","i","parseInt","length","push","removeClasses","join","indexOf","shift","a","$parse","$compile","$window","Utils","doTop","busy","onTop","$apply","then","sy","ey","setTimeout","undrag","doBottom","onBottom","lbottom2","offsetHeight","inner","lbottom","padding","dragging","wheeling","move","down","removeDragListeners","bounce","ltop","redraw","time","y","speed","Math","abs","cy","pause","min","max","innerStyle","transform","toFixed","set","showIndicatorFor","percent","iy","indicator","ix","round","rows","html","count","indicatorStyle","play","loop","aKey","window","requestAnimationFrame","cancelAnimationFrame","onDown","getTouch","addDragListeners","onMove","prev","onUp","up","_onWheel","event","dir","deltaY","wheelDelta","onWheel","ondragstart","$eval","attr","find","Style","append","contents","throttle","src","ngImg","image","Image","onload","$set","this","load","$watch","newValue","WebWorker","worker","doWork","onImageLoaded","post","url","data","error","ngImgWorker","replace","template","form","title","placeholder","name","formKey","formFocus","required","label","key","readonly","control","match","options","number","source","canCreate","flatten","queryable","onSelected","MAX_ITEMS","service","getPhrase","Clear","phrase","items","input","val","Current","current","active","onTyping","Enter","item","onSelect","Up","Down","Parse","value","index","toLowerCase","NameA","substr","NameB","NameC","Filter","c","Search","setPhrase","success","console","log","onKeyDown","keyCode","preventDefault","onKeyUp","call","getClosest","target","onBlur","Init","init","maxItems","Number","POSITIVE_INFINITY","onFocus","$parent","setItem","parsedItem","$item","$event","extend","$watchCollection","require","type","validateType","$parsers","unshift","$setValidity","String","toString","factory","Vector","x","make","b","size","sqrt","normalize","l","incidence","angle","atan2","distance","cross","difference","prototype","towards","friction","add","copy","previous","t","touch","originalEvent","touches","changedTouches","pageX","pageY","s","getRelativeTouch","point","rect","getBoundingClientRect","left","top","el","selector","matchesFn","parent","some","fn","document","body","parentElement","func","wait","context","args","result","timeout","later","leading","getNow","apply","now","remaining","arguments","clearTimeout","trailing","lastTime","vendors","callback","currTime","Date","getTime","timeToCall","id","transformProperty","safariPropertyHack","div","createElement","style","every","prefix","props","scale","hoverScale","currentScale","styles","cssText","transformOrigin","DataFilter","getSearchParams","search","p","getParams","infinite","JSON","stringify","page","$q","$http","$httpAsync","$rootScope","DataSource","maxPages","filters","resolve","uri","paging","get","deferred","pages","pagination","getPages","$broadcast","bind","flush","PAGES_MAX","opened","response","responseHeader","headers","responseView","parse","params","reject","defer","promise","refresh","more","filter","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","LocalStorage","isLocalStorageSupported","isSupported","cache","json","localStorage","onStorage","self","callbacks","Worker","onmessage","isWebWorkerSupported","transformResponse","h","eval","object","o","postMessage","status","wrap","getDefaults","isSuccess","createMap","Object","create","isString","parseHeaders","fillInParsed","parsed","j","line","lowercase","trim","isObject","headersGetter","headersObj","defaults","method","withCredentials","responseType","config","common","string","head","put","patch","getter","statusText","controller","$scope","$location","DishesTest"],"mappings":"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","file":"dist/js/ws-utils.min.js","sourcesContent":["/*global angular*/\r\n\r\nvar app = angular.module('wsUtils', ['ngMessages']);\r\n\n\n/*global angular*/\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name onTap\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'tapped' on element and removes it after a timeout of 500 ms\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <button type=\"button\" on-tap>Tap me!</button>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .tapped {\r\n            background: red;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('onTap', ['$timeout', function($timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         function onTap(e) {\r\n            element.addClass('tapped');\r\n            $timeout(function() {\r\n               element.removeClass('tapped');\r\n            }, 500)\r\n         };\r\n         function addListeners() {\r\n            element.on('touchstart mousedown', onTap);\r\n         };\r\n         function removeListeners() {\r\n            element.off('touchstart mousedown', onTap);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         addListeners();\r\n      }\r\n   }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name animate\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'animated' on element\r\n   *\r\n   * @param {string} [animate=fadeIn] a comma separated animate.css class names\r\n   * @param {string} [delay=1] a comma separated durations list in milliseconds\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div type=\"button\" animate=\"fadeInUp\" delay=\"1000\">\r\n            I'm an animated div.\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('animate', ['$timeout', function($timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         element.addClass('animated');\r\n         var animate = ['fadeIn'], delays = ['1'];\r\n         if (attributes.animate !== undefined) {\r\n            animate = attributes.animate.split(',');\r\n         }\r\n         if (attributes.delay !== undefined) {\r\n            delays = attributes.delay.split(',');\r\n         }\r\n         angular.forEach(delays, function(d, i) {\r\n            delays[i] = parseInt(d);\r\n         });\r\n         while (delays.length < animate.length) {\r\n            delays.push(delays[delays.length - 1] + 50);\r\n         }\r\n         var removeClasses = animate.join(' ');\r\n         if (animate[0].indexOf('In') !== -1) {\r\n            element.addClass('invisible');\r\n            removeClasses += ' invisible';\r\n         }\r\n         while (animate.length) {\r\n            var d = delays.shift();\r\n            var a = animate.shift();\r\n            $timeout(function() {\r\n               element.removeClass(removeClasses);\r\n               element.addClass(a);\r\n               if (animate.length === 0 && a.indexOf('Out') !== -1) {\r\n                  $timeout(function() {\r\n                     element.addClass('invisible');\r\n                  }, 1000);\r\n               }\r\n            }, d);\r\n         }\r\n      }\r\n   }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name scrollable\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Scrollable div 3d accellerated with touch functionality and callbacks for infinite scroll\r\n   *\r\n   * @param {promise} [on-top] optional callback function that execute when reaching top\r\n   * @param {promise} [on-bottom] optional callback function that execute when reaching bottom\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div ng-controller=\"TestCtrl\">\r\n            <section class=\"scrollable content\" scrollable on-top=\"$root.doRefresh()\">\r\n               <div class=\"inner\">\r\n                  <ul>\r\n                     <li ng-repeat=\"item in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]\">item <span ng-bind=\"item\"></span></li>\r\n                  </ul>\r\n               </div>\r\n            </section>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.controller('TestCtrl', ['$scope', '$q', function($scope, $q) {\r\n            $scope.doRefresh = function() {\r\n               var deferred = $q.defer();\r\n               if ($scope.busy) {\r\n                  deferred.reject();\r\n               } else {\r\n                  $scope.busy = true;\r\n                  $timeout(function() {\r\n                     $scope.busy = false;\r\n                     deferred.resolve();\r\n                  }, 500);\r\n               }\r\n               return deferred.promise;\r\n            };\r\n         }]);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .scrollable.content {\r\n            height: 200px!important;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('scrollable', ['$parse', '$compile', '$window', '$timeout', 'Utils', function($parse, $compile, $window, $timeout, Utils) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         $window.ondragstart = function() { return false; };\r\n         // CONSTS;\r\n         var padding = 150;\r\n         // FLAGS;\r\n         var dragging, wheeling, busy;\r\n         // MOUSE;\r\n         var down, move, prev, up;\r\n         // COORDS;\r\n         var sy = 0, ey = 0, cy = 0, ltop = 0, lbottom = 0, speed = 0, ix = 45, iy = 0;\r\n         // ANIMATION KEY;\r\n         var aKey;\r\n         var onTop, onBottom, showIndicatorFor;\r\n         if (attributes.onTop !== undefined) {\r\n            onTop = $parse(attributes.onTop, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         if (attributes.onBottom !== undefined) {\r\n            onBottom = $parse(attributes.onBottom, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         if (attributes.showIndicatorFor !== undefined) {\r\n            showIndicatorFor = scope.$eval(attributes.showIndicatorFor); // $parse(attributes.showIndicatorFor, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         // console.log('showIndicatorFor', showIndicatorFor);\r\n         // ELEMENTS & STYLESHEETS;\r\n         element.attr('unselectable', 'on').addClass('unselectable');\r\n         var inner = element.find('div');\r\n         var innerStyle = new Utils.Style();\r\n         var indicator = null, indicatorStyle;\r\n         if (showIndicatorFor) {\r\n            indicator = angular.element('<div class=\"indicator\"></div>');\r\n            indicatorStyle = new Utils.Style();\r\n            element.append(indicator);\r\n            $compile(indicator.contents())(scope);\r\n            indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n            indicatorStyle.set(indicator[0]);\r\n         }\r\n         function doTop() {\r\n            if (busy) {\r\n               return;\r\n            }\r\n            if (!onTop) {\r\n               return;\r\n            }\r\n            busy = true;\r\n            scope.$apply(onTop).then().finally(function() {\r\n               sy = ey = 0;\r\n               setTimeout(function() {\r\n                  undrag();\r\n                  busy = false;\r\n               }, 500);\r\n            });\r\n         }\r\n         function doBottom() {\r\n            if (busy) {\r\n               return;\r\n            }\r\n            if (!onBottom) {\r\n               return;\r\n            }\r\n            busy = true;\r\n            scope.$apply(onBottom).then().finally(function() {\r\n               var lbottom2 = element[0].offsetHeight - inner[0].offsetHeight;\r\n               if (lbottom2 > lbottom) {\r\n                  sy = ey = lbottom;\r\n               } else {\r\n                  sy = ey = lbottom + padding;\r\n               }\r\n               setTimeout(function() {\r\n                  undrag();\r\n                  busy = false;\r\n               }, 500);\r\n            });\r\n         }\r\n         function undrag() {\r\n            // console.log('undrag');\r\n            dragging = false;\r\n            wheeling = false;\r\n            move = null;\r\n            down = null;\r\n            removeDragListeners();\r\n         }\r\n         function bounce() {\r\n            ltop += padding;\r\n            lbottom -= padding;\r\n            if (ey > ltop) {\r\n               doTop();\r\n            } else if (ey < lbottom) {\r\n               doBottom();\r\n            }\r\n         }\r\n         function redraw(time) {\r\n            // if (!busy) {\r\n            ltop = 0;\r\n            lbottom = element[0].offsetHeight - inner[0].offsetHeight;\r\n            if (dragging) {\r\n               ey = sy + move.y - down.y;\r\n               bounce();\r\n            } else if (speed) {\r\n               ey += speed;\r\n               speed *= .75;\r\n               if (wheeling) {\r\n                  bounce();\r\n               }\r\n               if (Math.abs(speed) < 0.05) {\r\n                  speed = 0;\r\n                  ey = sy = cy;\r\n                  wheeling = false;\r\n                  pause();\r\n               }\r\n            }\r\n            // }\r\n            ey = Math.min(ltop, ey);\r\n            ey = Math.max(lbottom, ey);\r\n            cy += (ey - cy) / 4;\r\n            innerStyle.transform('translate3d(0,' + cy.toFixed(2) + 'px,0)');\r\n            innerStyle.set(inner[0]);\r\n            if (showIndicatorFor) {\r\n               if (dragging || wheeling || speed) {\r\n                  var percent = cy / (element[0].offsetHeight - inner[0].offsetHeight);\r\n                  percent = Math.max(0, Math.min(1, percent));\r\n                  iy = (element[0].offsetHeight - indicator[0].offsetHeight) * (percent);\r\n                  ix += (0 - ix) / 4;\r\n                  // var count = Math.round(inner[0].offsetHeight / 315);\r\n                  var i = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\r\n                  indicator.html(i + '/' + showIndicatorFor.count);\r\n                  // indicator.html((percent * 100).toFixed(2).toString());\r\n               } else {\r\n                  ix += (45 - ix) / 4;\r\n               }\r\n               indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n               indicatorStyle.set(indicator[0]);\r\n            }\r\n         }\r\n         function play() {\r\n            function loop(time) {\r\n               redraw(time);\r\n               aKey = window.requestAnimationFrame(loop, element);\r\n            }\r\n            if (!aKey) {\r\n               loop();\r\n            }\r\n         }\r\n         function pause() {\r\n            if (aKey) {\r\n               window.cancelAnimationFrame(aKey);\r\n               aKey = null;\r\n               // console.log('Animation.paused');\r\n            }\r\n         }\r\n         function onDown(e) {\r\n            if (!busy) {\r\n               sy = ey = cy;\r\n               speed = 0;\r\n               down = Utils.getTouch(e);\r\n               wheeling = false;\r\n               // console.log(down);\r\n               addDragListeners();\r\n               play();\r\n            }\r\n         }\r\n         function onMove(e) {\r\n            prev = move;\r\n            move = Utils.getTouch(e);\r\n            dragging = true;\r\n            // console.log(move);\r\n         }\r\n         function onUp(e) {\r\n            if (move && prev) {\r\n               speed += (move.y - prev.y) * 4;\r\n            }\r\n            sy = ey = cy;\r\n            dragging = false;\r\n            move = null;\r\n            down = null;\r\n            prev = null;\r\n            up = Utils.getTouch(e);\r\n            // console.log(up);\r\n            removeDragListeners();\r\n         }\r\n         function _onWheel(e) {\r\n            if (!busy) {\r\n               if (!e) e = event;\r\n               var dir = (((e.deltaY < 0 || e.wheelDelta > 0) || e.deltaY < 0) ? 1 : -1)\r\n               /*\r\n               var evt = window.event || e;\r\n               var delta = evt.detail ? evt.detail * -120 : evt.wheelDelta\r\n               speed += delta;\r\n               */\r\n               speed += dir * 5;\r\n               wheeling = true;\r\n               play();\r\n            }\r\n         }\r\n         var onWheel = Utils.throttle(_onWheel, 25);\r\n         function addListeners() {\r\n            element.on('touchstart mousedown', onDown);\r\n            element.on('wheel', onWheel);\r\n            // element.addEventListener('DOMMouseScroll',handleScroll,false); // for Firefox\r\n            // element.addEventListener('mousewheel',    handleScroll,false); // for everyone else\r\n         };\r\n         function removeListeners() {\r\n            element.off('touchstart mousedown', onDown);\r\n            element.off('wheel', onWheel);\r\n         };\r\n         function addDragListeners() {\r\n            angular.element($window).on('touchmove mousemove', onMove);\r\n            angular.element($window).on('touchend mouseup', onUp);\r\n         };\r\n         function removeDragListeners() {\r\n            angular.element($window).off('touchmove mousemove', onMove);\r\n            angular.element($window).off('touchend mouseup', onUp);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         addListeners();\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImg\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img=\"'/img/nature-01.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('ngImg', ['$parse', '$timeout', function($parse, $timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         var src = $parse(attributes.ngImg, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         var image = new Image();\r\n         image.onload = function() {\r\n            attributes.$set('src', this.src);\r\n            setTimeout(function() {\r\n               element.addClass('loaded');\r\n            }, 10);\r\n         }\r\n         image.load = function(src) {\r\n            element.removeClass('loaded');\r\n            this.src = src;\r\n         }\r\n         scope.$watch(src, function(newValue) {\r\n            if (!newValue) {\r\n               attributes.$set('src', null);\r\n            } else {\r\n               image.load(newValue);\r\n            }\r\n         });\r\n      }\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImgWorker\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * As ngImg but using webworker. Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img-worker=\"'/img/nature-02.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n\t</example>\r\n*/\r\napp.directive('ngImgWorker', ['$parse', 'WebWorker', function($parse, WebWorker) {\r\n   var worker = new WebWorker('/js/ws-utils/workers/loader.js');\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         function doWork(src) {\r\n            element.removeClass('loaded');\r\n            function onImageLoaded(src) {\r\n               attributes.$set('src', src);\r\n               setTimeout(function() {\r\n                  element.addClass('loaded');\r\n               }, 100);\r\n            }\r\n            worker.post({ url: src }).then(function(data) {\r\n               onImageLoaded(data.url);\r\n            }, function(error) {\r\n               onImageLoaded(null);\r\n            });\r\n         }\r\n         var src = scope.$eval(attributes.ngImgWorker);\r\n         if (!src) {\r\n            attributes.$set('src', null);\r\n         } else {\r\n            doWork(src);\r\n         }\r\n      }\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name control\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Dinamic form control generator through templates with extended validation\r\n   *\r\n   * @param {string} model the target model of control\r\n   * @param {string} [control=text] the type of control, available types (text, password, email, number, checkbox, textarea, datetime-local, select, autocomplete)\r\n   * @param {string} [form=Form] the name of the form\r\n   * @param {string} [title=Untitled] the title of the control\r\n   * @param {string} [placeholder=title] the placeholder of the control\r\n   * @param {string} [source=null] datasource of select as array\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   * @param {string} [required=false] if the control is required\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"select\" title=\"category\" placeholder=\"select a category\" model=\"model.category\" source=\"[{name:'Main',id:1}, {name:'Second',id:2}]\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"number\" title=\"dish price\" placeholder=\"type the price of the dish\" model=\"model.dish.price\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"checkbox\" title=\"is vegan friendly\" placeholder=\"please check if the dish is vegan friendly\" model=\"model.dish.isVeganFriendly\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('control', [function() {\r\n   return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      template: function(element, attributes) {\r\n         var form = attributes.form || 'Form';\r\n         var title = attributes.title || 'Untitled';\r\n         var placeholder = attributes.placeholder || title;\r\n         var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('');\r\n         var formKey = form + '.' + name;\r\n         var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n         var required = '';\r\n         var label = (attributes.label ? attributes.label : 'name');\r\n         var key = (attributes.key ? attributes.key : 'id');\r\n         var model = attributes.model;\r\n         if (attributes.required) {\r\n            required = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + form + '.' + name + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> &larr; required</span>';\r\n            switch (attributes.control) {\r\n               case 'password':\r\n                  required = required + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> &larr; at least 6 chars</span>';\r\n                  break;\r\n               case 'email':\r\n                  required = required + '<span ng-message=\"email\" class=\"label-error animated flash\"> &larr; incorrect</span>';\r\n                  break;\r\n               case 'number':\r\n                  required = required + '<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>';\r\n                  break;\r\n            }\r\n            if (attributes.match !== undefined) {\r\n               required = required + '<span ng-message=\"match\" class=\"label-error animated flash\"> &larr; not matching</span>';\r\n            }\r\n            required = required + '</span>';\r\n         } else {\r\n            required = ' (optional)';\r\n         }\r\n         var template = '<div ' + (attributes.readonly ? ' class=\"readonly\" ' : '') + ' ng-class=\"{ focus: ' + formKey + '.hasFocus, success: ' + formKey + '.$valid, error: ' + formKey + '.$invalid && (form.$submitted || ' + formKey + '.$touched), empty: !' + formKey + '.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + required + '</label>';\r\n         switch (attributes.control) {\r\n            case 'checkbox':\r\n               template = '<div class=\"checkbox\">';\r\n               template += '<span class=\"checkbox-label\">' + title + required + '</span>';\r\n               template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + (attributes.required ? 'required=\"true\"' : '') + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n               template += '</div>';\r\n               break;\r\n            case 'select':\r\n               var options = attributes.number\r\n                  ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source\r\n                  : 'item.' + label + ' for item in ' + attributes.source + ' track by item.' + key;\r\n               template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + ' ' + (attributes.required ? 'required=\"true\"' : '') + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n               break;\r\n            case 'autocomplete':\r\n               var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n               var flatten = (attributes.flatten ? attributes.flatten : false);\r\n               var queryable = (attributes.queryable ? attributes.queryable : false);\r\n               var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n               template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n               template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n               break;\r\n            case 'textarea':\r\n               template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" ' + (attributes.required ? 'required' : '') + ' rows=\"' + (attributes.rows ? attributes.rows : '1') + '\"' + formFocus + '></textarea>';\r\n               break;\r\n            case 'datetime-local':\r\n               placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n               break;\r\n            case 'password':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"6\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n               break;\r\n            case 'email':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n               break;\r\n            case 'number':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n               break;\r\n            case 'text':\r\n            default:\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n               break;\r\n         }\r\n         return template + '</div>';\r\n      },\r\n      link: function(scope, element, attributes, model) {\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name controlAutocomplete\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom control type with autocomplete functionality. (use the shortcut version with control directive)\r\n   *\r\n   * @param {service} controlAutocomplete the datasource service\r\n   * @param {model} model the target model of control\r\n   * @param {boolean} [canCreate=false] setted on true the control can add new entities\r\n   * @param {boolean} [flatten=false] set to true to flat the value to the model\r\n   * @param {boolean} [queryable=false] set to true if is a queryable service\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12 empty focus\">\r\n                     <label for=\"dishname\" class=\"control-label\">dish name<span ng-messages=\"(myForm.$submitted || myForm.dishname.$touched) &amp;&amp; myForm.dishname.$error\" role=\"alert\" class=\"ng-inactive\"></span></label>\r\n                     <input name=\"dishname\" ng-model=\"model.name\" type=\"hidden\" required=\"\">\r\n                     <div control-autocomplete=\"dishesAutocomplete\" model=\"model.name\" label=\"name\" key=\"name\" can-create=\"true\" flatten=\"true\" queryable=\"false\" placeholder=\"type the name of the dish\" on-focus=\"myForm.dishname.hasFocus=true\" on-blur=\"myForm.dishname.hasFocus=false\" on-selected=\"onDishSelected($item)\" class=\"ng-isolate-scope\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.run(['$rootScope', '$q', function($rootScope, $q) {\r\n            $rootScope.dishesAutocomplete = ;\r\n            $rootScope.onDishSelected = function($item) {\r\n               alert($item);\r\n            };\r\n         }]);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('controlAutocomplete', ['$parse', '$window', '$timeout', function($parse, $window, $timeout) {\r\n   var MAX_ITEMS = 5;\r\n   return {\r\n      restrict: 'A',\r\n      scope: {\r\n         service: '=controlAutocomplete',\r\n         canCreate: '=',\r\n         flatten: '=',\r\n         queryable: '=',\r\n         model: '=',\r\n         label: '@',\r\n         key: '@',\r\n      },\r\n      template: function(element, attributes) {\r\n         var template = '<div>';\r\n         template += '   <input class=\"form-control\" ng-model=\"phrase\" ng-model-options=\"{ debounce: 150 }\" placeholder=\"' + attributes.placeholder + '\" type=\"text\" ng-focus=\"onFocus()\">';\r\n         template += '   <ul class=\"form-autocomplete\" ng-show=\"items.length\">';\r\n         template += '       <li ng-repeat=\"item in items\" ng-class=\"{ active: active == $index }\" ng-click=\"onSelect(item)\">';\r\n         template += '           <span>{{item.NameA}}<span class=\"token\">{{item.NameB}}</span>{{item.NameC}}</span>';\r\n         template += '       </li>';\r\n         template += '   </ul>';\r\n         template += '</div>';\r\n         return template;\r\n      },\r\n      link: function(scope, element, attributes, model) {\r\n         var onSelected = $parse(attributes.onSelected);\r\n         var input = element.find('input');\r\n         var label = (scope.label ? scope.label : 'name');\r\n         var key = (scope.key ? scope.key : 'id');\r\n         function getPhrase() {\r\n            if (scope.model) {\r\n               return scope.flatten ? scope.model : scope.model[label];\r\n            } else {\r\n               return null;\r\n            }\r\n         }\r\n         scope.phrase = getPhrase();\r\n         scope.count = 0;\r\n         scope.items = [];\r\n         scope.active = -1;\r\n         scope.maxItems = scope.maxItems || Number.POSITIVE_INFINITY;\r\n         function Clear(phrase) {\r\n            scope.items.length = 0;\r\n            scope.count = 0;\r\n            scope.phrase = phrase || null;\r\n            input.val(scope.phrase);\r\n         }\r\n         function Current() {\r\n            var current = null;\r\n            if (scope.active != -1 && scope.items.length > scope.active) {\r\n               current = scope.items[scope.active];\r\n            }\r\n            return current;\r\n         }\r\n         scope.onFocus = function() {\r\n            if (attributes.onFocus !== undefined) {\r\n               scope.$parent.$eval(attributes.onFocus);\r\n            }\r\n            if (input.val() === getPhrase()) {\r\n               input.val(null);\r\n            }\r\n         };\r\n         scope.onBlur = function() {\r\n            if (attributes.onBlur !== undefined) {\r\n               scope.$parent.$eval(attributes.onBlur);\r\n            }\r\n            Clear(getPhrase());\r\n         };\r\n         scope.onSelect = function(item) {\r\n            if (scope.queryable) {\r\n               scope.service.setItem(item).then(function(parsedItem) {\r\n                  onSelected({ $item: parsedItem }, scope.$parent, { $event: {} });\r\n                  $timeout(function() {\r\n                     if (scope.flatten) {\r\n                        scope.model = parsedItem[key];\r\n                     } else {\r\n                        scope.model = scope.model || {};\r\n                        angular.extend(scope.model, parsedItem);\r\n                     }\r\n                     scope.onBlur();\r\n                  }, 1);\r\n               });\r\n            } else {\r\n               onSelected({ $item: item }, scope.$parent, { $event: {} });\r\n               if (scope.flatten) {\r\n                  scope.model = item[key];\r\n               } else {\r\n                  scope.model = scope.model || {};\r\n                  angular.extend(scope.model, item);\r\n               }\r\n               scope.onBlur();\r\n            }\r\n         };\r\n         function onTyping(phrase) {\r\n            if (scope.canCreate) {\r\n               if (scope.flatten) {\r\n                  if (key === label) {\r\n                     scope.model = phrase;\r\n                  }\r\n               } else {\r\n                  scope.model = {};\r\n                  scope.model[label] = phrase;\r\n               }\r\n            }\r\n         };\r\n         function Enter() {\r\n            var item = Current();\r\n            if (item) {\r\n               scope.onSelect(item);\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Up() {\r\n            scope.active--;\r\n            if (scope.active < 0) {\r\n               scope.active = scope.items.length - 1;\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Down() {\r\n            scope.active++;\r\n            if (scope.items.length == 0) {\r\n               scope.active = -1;\r\n            } else if (scope.active >= scope.items.length) {\r\n               scope.active = 0;\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Parse(data) {\r\n            scope.items = data.items;\r\n            scope.count = data.count;\r\n            angular.forEach(scope.items, function(value, index) {\r\n               var name = value[label];\r\n               var i = name.toLowerCase().indexOf(scope.phrase.toLowerCase());\r\n               value.NameA = name.substr(0, i);\r\n               value.NameB = name.substr(i, scope.phrase.length);\r\n               value.NameC = name.substr(i + scope.phrase.length, name.length - (i + scope.phrase.length));\r\n            });\r\n         }\r\n         function Filter(data) {\r\n            var c = 0, i = [];\r\n            if (scope.phrase.length > 1) {\r\n               angular.forEach(data.items, function(value, index) {\r\n                  var name = value[label];\r\n                  if (name.toLowerCase().indexOf(scope.phrase.toLowerCase()) !== -1) {\r\n                     if (i.length < MAX_ITEMS) {\r\n                        i.push(value);\r\n                     }\r\n                     c++;\r\n                  }\r\n               });\r\n            }\r\n            Parse({\r\n               count: c,\r\n               items: i\r\n            });\r\n         }\r\n         function Search() {\r\n            scope.phrase = input.val();\r\n            scope.active = -1;\r\n            onTyping(scope.phrase);\r\n            if (scope.queryable) {\r\n               scope.service.setPhrase(scope.phrase).then(function(success) {\r\n                  scope.items = success.items;\r\n                  scope.count = success.count;\r\n               }, function(error) {\r\n                  console.log('Search.queryable.error', scope.phrase, error);\r\n               }).finally(function() {\r\n\r\n               });\r\n            } else {\r\n               Filter({\r\n                  count: scope.service.length,\r\n                  items: scope.service\r\n               });\r\n               scope.$apply();\r\n            }\r\n         }\r\n         function onKeyDown(e) {\r\n            switch (e.keyCode) {\r\n               case 9: // Tab\r\n               case 13: // Enter\r\n                  Enter();\r\n                  if (scope.items.length) {\r\n                     e.preventDefault ? e.preventDefault() : null;\r\n                     return false;\r\n                  }\r\n                  break;\r\n               case 38: // Up\r\n                  Up();\r\n                  break;\r\n               case 40: // Down\r\n                  Down();\r\n                  break;\r\n            }\r\n         }\r\n         function onKeyUp(e) {\r\n            switch (e.keyCode) {\r\n               case 9: // Tab\r\n               case 13: // Enter\r\n                  break;\r\n               case 39: // Right\r\n                  break;\r\n               case 37: // Left\r\n                  break;\r\n               case 38: // Up\r\n                  break;\r\n               case 40: // Down\r\n                  break;\r\n               default: // Text\r\n                  Search.call(this);\r\n                  break;\r\n            }\r\n         }\r\n         function onUp(e) {\r\n            if (Utils.getClosest(e.target, '[control-autocomplete]') === null) {\r\n               scope.$apply(function() {\r\n                  scope.onBlur();\r\n               });\r\n            }\r\n            return true;\r\n         }\r\n         function addListeners() {\r\n            input.on('keydown', onKeyDown);\r\n            input.on('keyup', onKeyUp);\r\n            angular.element($window).on('mouseup touchend', onUp);\r\n         };\r\n         function removeListeners() {\r\n            input.off('keydown', onKeyDown);\r\n            input.off('keyup', onKeyUp);\r\n            angular.element($window).off('mouseup touchend', onUp);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         var init = false;\r\n         function Init() {\r\n            if (!init) {\r\n               addListeners();\r\n               init = true;\r\n            }\r\n         }\r\n         scope.$watch('service', function(newValue) {\r\n            if (newValue && (newValue.length || scope.queryable)) {\r\n               Init();\r\n            }\r\n         });\r\n         scope.$watchCollection('model', function(newValue) {\r\n            if (newValue) {\r\n               if (scope.flatten && label === key) {\r\n                  scope.phrase = newValue;\r\n                  input.val(scope.phrase);\r\n               } else if (newValue[label]) {\r\n                  scope.phrase = newValue[label];\r\n                  input.val(scope.phrase);\r\n               }\r\n            }\r\n         });\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name validateType\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom validation type for ngModel\r\n   *\r\n   * @param {string} [validateType=number] the type of custom validation\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n\t\t<file name=\"index.html\">\r\n\t\t\t<form name=\"myForm\">\r\n\t\t\t\t<input name=\"myValue\" type=\"text\" ng-model=\"model\" validate-type=\"number\" />\r\n\t\t\t\t<span ng-messages=\"(myForm.$submitted || myForm.$touched) && myForm.myValue.$error\" role=\"alert\">\r\n\t\t\t\t\t<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>\r\n\t\t\t\t</span>\r\n\t\t\t</form>\r\n\t\t</file>\r\n\t\t<file name=\"script.js\">\r\n\t\t\tangular.module('examples', ['wsUtils']);\r\n\t\t</file>\r\n\t</example>\r\n*/\r\napp.directive('validateType', function() {\r\n   return {\r\n      require: 'ngModel',\r\n      link: function(scope, element, attributes, model) {\r\n         var type = attributes.validateType;\r\n         switch (type) {\r\n            case 'number':\r\n               model.$parsers.unshift(function(value) {\r\n                  model.$setValidity(type, String(value).indexOf(Number(value).toString()) !== -1);\r\n                  return value;\r\n               });\r\n               break;\r\n         }\r\n      }\r\n   };\r\n});\r\n\n/*global angular*/\r\n\r\napp.factory('Vector', function() {\r\n\tfunction Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n});\r\n\r\napp.factory('Utils', ['Vector', function (Vector) {\r\n    (function () {\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };\r\n        }\r\n    }());\r\n\r\n    var transformProperty = function detectTransformProperty() {\r\n        var transformProperty = 'transform',\r\n            safariPropertyHack = 'webkitTransform';\r\n\t\tvar div = document.createElement(\"DIV\");\r\n        if (typeof div.style[transformProperty] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function(prefix) {\r\n                var e = '-' + prefix + '-transform';\r\n                if (typeof div.style[e] !== 'undefined') {\r\n                    transformProperty = e;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof div.style[safariPropertyHack] !== 'undefined') {\r\n            transformProperty = '-webkit-transform';\r\n        } else {\r\n            transformProperty = undefined;\r\n        }\r\n        return transformProperty;\r\n    } ();\r\n\r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left,  rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    var getNow = Date.now || function() {\r\n        return new Date().getTime();\r\n    };\r\n\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n\r\n    var Style = function() {\r\n        function Style() {\r\n            this.props = {\r\n                scale: 1,\r\n                hoverScale: 1,\r\n                currentScale: 1,\r\n            }\r\n        }\r\n        Style.prototype = {\r\n            set: function (element) {\r\n                var styles = [];\r\n                angular.forEach(this, function (value, key) {\r\n                    if (key !== 'props')\r\n                        styles.push(key + ':' + value);\r\n                });\r\n                element.style.cssText = styles.join(';') + ';';\r\n            },\r\n            transform: function (transform) {\r\n                this[Utils.transformProperty] = transform;\r\n            },\r\n            transformOrigin: function (x, y) {\r\n                this[Utils.transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n                this[Utils.transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n            },\r\n        };\r\n        return Style;\r\n    }();\r\n\r\n    function Utils() {\r\n    }\r\n\r\n\tUtils.transformProperty = transformProperty;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.throttle = throttle;\r\n    Utils.Style = Style;\r\n\r\n    return Utils;\r\n}]);\r\n\n/*global angular*/\r\n\r\napp.factory('DataFilter', [function () {\r\n    function DataFilter(data) {\r\n        /*\r\n        this.dateFrom = null;\r\n        this.dateTo = null;\r\n        this.search = null;\r\n        this.status = null;\r\n        */\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    DataFilter.prototype = {\r\n        getSearchParams: function (search) {\r\n            var a = [];\r\n            if (search) {\r\n                for (var p in search) {\r\n                    a.push({ name: p, value: search[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source, infinite) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                if (p === 'dateFrom' ||\r\n                    p === 'dateTo' ||\r\n                    p === 'status') {\r\n                    value = this[p];\r\n                    if (value !== undefined) {\r\n                        post[p] = value;\r\n                    }\r\n                } else if (p === 'search') {\r\n                    post[p] = JSON.stringify(this.getSearchParams(this[p]), null, '');\r\n                }\r\n            }\r\n            post.page = source.page;\r\n            post.size = source.size;\r\n            post.infinite = infinite;\r\n            return post;\r\n        },\r\n    };\r\n    return DataFilter;\r\n}]);\r\n\r\napp.factory('DataSource', ['$q', '$http', '$httpAsync', '$timeout', '$rootScope', 'DataFilter', function ($q, $http, $httpAsync, $timeout, $rootScope, DataFilter) {\r\n\r\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\r\n\r\n    function DataSource(data) {\r\n        this.busy = false;\r\n        this.error = false;\r\n        this.size = 10;\r\n        this.maxPages = 10;\r\n        this.rows = [];\r\n        this.filters = {};\r\n        this.service = {\r\n            url: '/api/items/paging',\r\n            resolve: function (items, rows) {\r\n                angular.forEach(items, function (item) {\r\n                    this.push(item);\r\n                }, rows);\r\n            },\r\n        };\r\n        data ? angular.extend(this, data) : null;\r\n        this.filters = new DataFilter(this.filters);\r\n        // FAKE SERVICE FOR TEST !!!\r\n        if (this.service.uri.paging === false) {\r\n            this.get = function (deferred, infinite) {\r\n                this.busy = true;\r\n                this.error = false;\r\n                $timeout(function () {\r\n                    infinite ? null : this.rows.length = 0;\r\n                    this.service.resolve(this.rows);\r\n                    this.page = 1;\r\n                    this.pages = 2;\r\n                    this.count = this.rows.length;\r\n                    this.pagination = this.getPages();\r\n                    this.busy = false;\r\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                    deferred.resolve(this.rows);\r\n                    // console.log('DataSource.get');\r\n                }.bind(this), 1000);\r\n            };\r\n        }\r\n        this.flush();\r\n    }\r\n    DataSource.prototype = {\r\n        flush: function () {\r\n            this.pages = PAGES_MAX;\r\n            this.page = 1;\r\n            this.count = 0;\r\n            this.opened = null;\r\n        },\r\n        resolve: function (response) {\r\n            var responseHeader = response.headers('X-Pagination');\r\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\r\n            // console.log('response', response, 'responseHeader', responseHeader, 'responseView', responseView);\r\n            if (responseView) {\r\n                this.page = responseView.page;\r\n                this.size = responseView.size;\r\n                this.pages = responseView.pages;\r\n                this.count = responseView.count;\r\n            } else {\r\n                this.page = 0;\r\n                this.size = responseView.size;\r\n                this.pages = 0;\r\n                this.count = 0;\r\n            }\r\n            this.pagination = this.getPages();\r\n        },\r\n        get: function (deferred, infinite) {\r\n            this.busy = true;\r\n            this.error = false;\r\n            $httpAsync.get(this.service.uri.paging, { params: this.filters.getParams(this) }).then(function success(response) {\r\n                this.resolve(response);\r\n                infinite ? null : this.rows.length = 0;\r\n                this.service.resolve(response.data, this.rows);\r\n                $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                deferred.resolve(this.rows);\r\n            }.bind(this), function error(response) {\r\n                console.log('error.response', response);\r\n                this.error = true;\r\n                deferred.reject(response);\r\n            }.bind(this))\r\n                .finally(function () {\r\n                    // console.log('DataSource.get');\r\n                    $timeout(function () {\r\n                        this.busy = false;\r\n                    }.bind(this), 1000);\r\n                }.bind(this));\r\n        },\r\n        paging: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.paging');\r\n                this.opened = null;\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        refresh: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.refresh');\r\n                this.flush();\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        more: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page + 1 > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.more');\r\n                this.page++;\r\n                this.get(deferred, true);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        filter: function () {\r\n            this.page = 1;\r\n            this.pages = PAGES_MAX;\r\n            this.paging();\r\n        },\r\n        prevPage: function () {\r\n            var page = this.page - 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        nextPage: function () {\r\n            var page = this.page + 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        gotoPage: function (page) {\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        firstPage: function () {\r\n            if (this.page !== 1) {\r\n                this.page = 1;\r\n                this.paging();\r\n            }\r\n        },\r\n        lastPage: function () {\r\n            if (this.page !== this.pages) {\r\n                this.page = this.pages;\r\n                this.paging();\r\n            }\r\n        },\r\n        hasMany: function () {\r\n            return this.count > 0 && this.pages > this.maxPages;\r\n        },\r\n        hasMorePagesBehind: function () {\r\n            var startingIndex = Math.max(0, this.page - this.maxPages);\r\n            return startingIndex > 0;\r\n        },\r\n        hasMorePagesNext: function () {\r\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\r\n            return endingIndex < this.pages;\r\n        },\r\n        isPage: function (number) {\r\n            return this.page === number;\r\n        },\r\n        hasPages: function () {\r\n            return this.pages > 0 && this.pages < PAGES_MAX;\r\n        },\r\n        getPages: function () {\r\n            var a = [], i;\r\n            if (this.hasPages()) {\r\n                var startingIndex = Math.max(0, this.page - this.maxPages);\r\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\r\n                i = startingIndex;\r\n                while (i < endingIndex) {\r\n                    a.push({ number: (i + 1) });\r\n                    i++;\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        openClose: function (index) {\r\n            if (this.opened === index) {\r\n                this.opened = null;\r\n            } else {\r\n                this.opened = index;\r\n            }\r\n        }\r\n    };\r\n    return DataSource;\r\n}]);\r\n\r\napp.factory('LocalStorage', ['$http', '$q', '$window', function ($http, $q, $window) {\r\n    function LocalStorage() {\r\n    }\r\n\r\n    function isLocalStorageSupported() {\r\n        try {\r\n            return 'localStorage' in window && window['localStorage'] !== null;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n    LocalStorage.isSupported = isLocalStorageSupported();\r\n    if (!LocalStorage.isSupported) {\r\n        console.log('LocalStorage.unsupported');\r\n    }\r\n\r\n    /** STATIC CLASS METHODS **/\r\n    LocalStorage.set = function (key, data) {\r\n        if (!this.isSupported) {\r\n            return;\r\n        }\r\n        try {\r\n            var cache = [];\r\n            var json = JSON.stringify(data, function (key, value) {\r\n                if (key === 'pool') {\r\n                    return;\r\n                }\r\n                if (typeof value === 'object' && value !== null) {\r\n                    if (cache.indexOf(value) !== -1) {\r\n                        // Circular reference found, discard key\r\n                        return;\r\n                    }\r\n                    cache.push(value);\r\n                }\r\n                return value;\r\n            });\r\n            cache = null;\r\n            $window.localStorage.setItem(key, json);;\r\n        } catch (e) {\r\n            console.log('LocalStorage.set.error serializing', key, data, e);\r\n        }\r\n    };\r\n\r\n    LocalStorage.get = function (key) {\r\n        if (!this.isSupported) {\r\n            return;\r\n        }\r\n        var data = null;\r\n        if ($window.localStorage[key] !== undefined) {\r\n            try {\r\n                data = JSON.parse($window.localStorage[key]);\r\n            } catch (e) {\r\n                console.log('LocalStorage.get.error parsing', key, e);\r\n            }\r\n        }\r\n        return data;\r\n    };\r\n\r\n    // Register on storage event\r\n    LocalStorage.onStorage = function () {\r\n        console.log('LocalStorage.onStorage', arguments);\r\n    };\r\n    angular.element($window).on('storage', LocalStorage.onStorage);\r\n\r\n    return LocalStorage;\r\n}]);\r\n\r\napp.factory('WebWorker', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        window.Worker = function () {\r\n            function Worker(src) {\r\n                var self = this;\r\n                $http.get(src, { transformResponse: function (d, h) { return d } }).then(function success(response) {\r\n                    try {\r\n                        eval('self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\\n ' + response.data + ' };');\r\n                        self.object = new self.o();\r\n                        self.object.postMessage = function (e) {\r\n                            self.onmessage({data:e});\r\n                        }\r\n                    } catch(e) {\r\n                        console.log(\"Worker error \", e);\r\n                    }\r\n                }, function error(response) {\r\n                    console.log(\"Worker not found\");\r\n                });\r\n            }\r\n            Worker.prototype = {\r\n                onmessage: function (e) {\r\n                    console.log('Worker not implemented');\r\n                },\r\n                postMessage: function (e) {\r\n                    this.object.onmessage({ data: e });\r\n                }\r\n            }\r\n            return Worker;\r\n        } ();\r\n    }\r\n    function WebWorker(src) {\r\n        var self = this;\r\n        this.callbacks = {};\r\n        this.id = 0;\r\n        this.worker = new Worker(src);\r\n        this.worker.onmessage = function (e) {\r\n            self.onmessage(e);\r\n        };\r\n    }\r\n    WebWorker.prototype = {\r\n        parse: function (e) {\r\n            return JSON.parse(e.data);\r\n        },\r\n        stringify: function (data) {\r\n            return JSON.stringify(data);\r\n        },\r\n        onmessage: function (e) {\r\n            var data = this.parse(e);\r\n            var deferred = this.callbacks[data.id];\r\n            if (data.status !== -1) {\r\n                deferred.resolve(data);\r\n            } else {\r\n                deferred.reject(data);\r\n            }\r\n            delete this.callbacks[data.id];\r\n        },\r\n        post: function (data) {\r\n            var deferred = $q.defer();\r\n            data.id = this.id;\r\n            this.callbacks[this.id.toString()] = deferred;\r\n            this.id++;\r\n            this.worker.postMessage(this.stringify(data));\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    WebWorker.isSupported = isWebWorkerSupported;\r\n    return WebWorker;\r\n}]);\r\n\r\napp.factory('$httpAsync', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        return $http;\r\n    }\r\n    var worker = new Worker('/js/workers/http.js');\r\n    var callbacks = {};\r\n    var id = 0;\r\n    var lowercase = function (string) { return isString(string) ? string.toLowerCase() : string; };\r\n    var trim = function (value) {\r\n        return isString(value) ? value.trim() : value;\r\n    };\r\n    function $httpAsync(options) {\r\n        var deferred = $q.defer();\r\n        var wrap = getDefaults(options);\r\n        wrap.id = id.toString();\r\n        console.log('wrap', wrap);\r\n        /*\r\n        var xsrfValue = urlIsSameOrigin(config.url)\r\n            ? $$cookieReader()[config.xsrfCookieName || defaults.xsrfCookieName]\r\n            : undefined;\r\n        if (xsrfValue) {\r\n          reqHeaders[(config.xsrfHeaderName || defaults.xsrfHeaderName)] = xsrfValue;\r\n        }\r\n        $httpBackend(config.method, url, reqData, done, reqHeaders, config.timeout,\r\n            config.withCredentials, config.responseType);\r\n        */\r\n        callbacks[wrap.id] = deferred;\r\n        id++;\r\n        worker.postMessage($httpAsync.stringify(wrap));\r\n        return deferred.promise;\r\n    }\r\n    $httpAsync.get = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'GET',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.delete = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'DELETE',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.head = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'HEAD',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.post = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'POST',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.put = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PUT',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.patch = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PATCH',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.parse = function (e) {\r\n        return JSON.parse(e.data);\r\n    };\r\n    $httpAsync.stringify = function (data) {\r\n        return JSON.stringify(data);\r\n    };\r\n    $httpAsync.isSupported = isWebWorkerSupported;\r\n    worker.onmessage = function (e) {\r\n        var wrap = $httpAsync.parse(e);\r\n        console.log('onmessage', wrap);\r\n        var deferred = callbacks[wrap.id];\r\n        var status = wrap.status >= -1 ? wrap.status : 0;\r\n        var getter = headersGetter(wrap.response.headers);\r\n        (isSuccess(status) ? deferred.resolve : deferred.reject)({\r\n            data: wrap.response.data, // !!!! JSON.parse(wrap.response.data),\r\n            headers: getter,\r\n            status: wrap.response.status,\r\n            statusText: wrap.response.statusText,\r\n            config: wrap.config,\r\n        });\r\n        delete callbacks[wrap.id];\r\n    }\r\n    return $httpAsync;\r\n    function isSuccess(status) {\r\n        return 200 <= status && status < 300;\r\n    }\r\n    function createMap() {\r\n        return Object.create(null);\r\n    }\r\n    function isString(value) { return typeof value === 'string'; }\r\n    function parseHeaders(headers) {\r\n        var parsed = createMap(), i;\r\n        function fillInParsed(key, val) {\r\n            if (key) {\r\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\r\n            }\r\n        }\r\n        if (isString(headers)) {\r\n            var a = headers.split('\\n');\r\n            for (var j = 0; j < a.length; j++) {\r\n                var line = a[j];\r\n                i = line.indexOf(':');\r\n                fillInParsed(lowercase(trim(line.substr(0, i))), trim(line.substr(i + 1)));\r\n            }\r\n        } else if (isObject(headers)) {\r\n            for (var p in headers) {\r\n                fillInParsed(lowercase(p), trim(headers[p]));\r\n            }\r\n        }\r\n        return parsed;\r\n    }\r\n    function headersGetter(headers) {\r\n        var headersObj;\r\n        return function (name) {\r\n            if (!headersObj) headersObj = parseHeaders(headers);\r\n            if (name) {\r\n                var value = headersObj[lowercase(name)];\r\n                if (value === void 0) {\r\n                    value = null;\r\n                }\r\n                return value;\r\n            }\r\n            return headersObj;\r\n        };\r\n    }\r\n    function getDefaults(options) {\r\n        var defaults = {\r\n            method: 'GET',\r\n            withCredentials: false,\r\n            responseType: 'json',\r\n            headers: {},\r\n            config: {}\r\n        }\r\n        defaults.withCredentials = $http.defaults.withCredentials;\r\n        angular.extend(defaults.headers, $http.defaults.headers.common);\r\n        var method = (options.method || defaults.method).toLowerCase();\r\n        if ($http.defaults.headers[method]) {\r\n            angular.extend(defaults.headers, $http.defaults.headers[method]);\r\n        }\r\n        console.log('defaults', $http.defaults);\r\n        // defaults = angular.extend(defaults, $http.defaults);\r\n        /*\r\n    method{string}:                     HTTP method (e.g. 'GET', 'POST', etc)\r\n    url:{string}:                       Absolute or relative URL of the resource that is being requested.\r\n    params:{Object.<string|Object>}:    Map of strings or objects which will be serialized with the paramSerializer and appended as GET parameters.\r\n\r\n    data:{string|Object}:               Data to be sent as the request message data.\r\n    headers:{Object}:                   Map of strings or functions which return strings representing HTTP headers to send to the server. If the return value of a function is null, the header will not be sent. Functions accept a config object as an argument.\r\n\r\n    xsrfHeaderName:{string}:            Name of HTTP header to populate with the XSRF token.\r\n    xsrfCookieName:{string}:            Name of cookie containing the XSRF token.\r\n    transformRequest:{function(data, headersGetter)|Array.<function(data, headersGetter)>}:         transform function or an array of such functions. The transform function takes the http request body and headers and returns its transformed (typically serialized) version. See Overriding the Default Transformations\r\n\r\n    transformResponse:{function(data, headersGetter, status)|Array.<function(data, headersGetter, status)>}:    transform function or an array of such functions. The transform function takes the http response body, headers and status and returns its transformed (typically deserialized) version. See Overriding the Default TransformationjqLiks\r\n\r\n    paramSerializer:{string|function(Object<string,string>):string}:        A function used to prepare the string representation of request parameters (specified as an object). If specified as string, it is interpreted as function registered with the $injector, which means you can create your own serializer by registering it as a service. The default serializer is the $httpParamSerializer; alternatively, you can use the $httpParamSerializerJQLike\r\n\r\n    cache:{boolean|Cache}:              If true, a default $http cache will be used to cache the GET request, otherwise if a cache instance built with $cacheFactory, this cache will be used for caching.\r\n\r\n    timeout:{number|Promise}:           timeout in milliseconds, or promise that should abort the request when resolved.\r\n    withCredentials:{boolean}:          whether to set the withCredentials flag on the XHR object. See requests with credentials for more information.\r\n\r\n    responseType:{string}:              see XMLHttpRequest.responseType.\r\n        */\r\n        options ? options = angular.extend(defaults, options) : defaults;\r\n        return options;\r\n    }\r\n}]);\r\n\n/*global angular*/\r\n\r\napp.controller('TestCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'DishesTest', function ($scope, $location, $timeout, DataSource, DishesTest) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n\r\n    $scope.source = new DataSource({\r\n        service: DishesTest,\r\n        filters: $scope.filters\r\n    });\r\n\r\n    $timeout(function() {\r\n        $scope.source.paging();\r\n    }, 1000);\r\n\r\n}]);\r\n"],"sourceRoot":"/source/"}