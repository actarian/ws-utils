var app=angular.module("wsUtils",["ngMessages"]);app.directive("onTap",["$timeout",function(e){return{restrict:"A",link:function(t,n,o,r){function a(t){n.addClass("tapped"),e(function(){n.removeClass("tapped")},500)}function i(){n.on("touchstart mousedown",a)}function s(){n.off("touchstart mousedown",a)}t.$on("$destroy",function(){s()}),i()}}}]),app.directive("animate",["$timeout",function(e){return{restrict:"A",link:function(t,n,o,r){n.addClass("animated");var a=["fadeIn"],i=["1"];for(void 0!==o.animate&&(a=o.animate.split(",")),void 0!==o.delay&&(i=o.delay.split(",")),angular.forEach(i,function(e,t){i[t]=parseInt(e)});i.length<a.length;)i.push(i[i.length-1]+50);var s=a.join(" ");for(-1!==a[0].indexOf("In")&&(n.addClass("invisible"),s+=" invisible");a.length;){var u=i.shift(),l=a.shift();e(function(){n.removeClass(s),n.addClass(l),0===a.length&&-1!==l.indexOf("Out")&&e(function(){n.addClass("invisible")},1e3)},u)}}}}]),app.directive("validateType",function(){return{require:"ngModel",link:function(e,t,n,o){var r=n.validateType;switch(r){case"number":o.$parsers.unshift(function(e){return o.$setValidity(r,-1!==String(e).indexOf(Number(e).toString())),e})}}}}),app.directive("control",[function(){return{restrict:"A",replace:!0,template:function(e,t){var n=t.form||"Form",o=t.title||"Untitled",r=t.placeholder||o,a=o.replace(/[^0-9a-zA-Z]/g,"").split(" ").join(""),i=n+"."+a,s=' ng-focus="'+i+'.hasFocus=true" ng-blur="'+i+'.hasFocus=false"',u="",l=t.label?t.label:"name",c=t.key?t.key:"id",f=t.model;if(t.required){switch(u='<span ng-messages="'+(t.readonly?"":"("+n+".$submitted || "+i+".$touched) && ")+n+"."+a+'.$error" role="alert"><span ng-message="required" class="label-error animated flash"> &larr; required</span>',t.control){case"password":u+='<span ng-message="minlength" class="label-error animated flash"> &larr; at least 6 chars</span>';break;case"email":u+='<span ng-message="email" class="label-error animated flash"> &larr; incorrect</span>';break;case"number":u+='<span ng-message="number" class="label-error animated flash"> &larr; enter a valid number</span>'}void 0!==t.match&&(u+='<span ng-message="match" class="label-error animated flash"> &larr; not matching</span>'),u+="</span>"}else u=" (optional)";var h="<div "+(t.readonly?' class="readonly" ':"")+' ng-class="{ focus: '+i+".hasFocus, success: "+i+".$valid, error: "+i+".$invalid && (form.$submitted || "+i+".$touched), empty: !"+i+'.$viewValue }"><label for="'+a+'" class="control-label">'+o+u+"</label>";switch(t.control){case"checkbox":h='<div class="checkbox">',h+='<span class="checkbox-label">'+o+u+"</span>",h+='<span class="switch"><input id="'+a+'" name="'+a+'" type="checkbox" ng-model="'+f+'" '+(t.required?'required="true"':"")+' class="toggle toggle-round-flat"><label for="'+a+'"></label></span>',h+="</div>";break;case"select":var p=t.number?"item."+c+" as item."+l+" for item in "+t.source:"item."+l+" for item in "+t.source+" track by item."+c;h+='<select name="'+a+'" class="form-control" ng-model="'+f+'" ng-options="'+p+'" '+(t.number?"convert-to-number":"")+" "+(t.required?'required="true"':"")+'><option value="" disabled selected hidden>'+r+"</option></select>";break;case"autocomplete":var d=t.canCreate?t.canCreate:!1,m=t.flatten?t.flatten:!1,g=t.queryable?t.queryable:!1,v=t.onSelected?' on-selected="'+t.onSelected+'"':"";h+='<input name="'+a+'" ng-model="'+f+'" type="hidden" '+(t.required?"required":"")+">",h+='<div control-autocomplete="'+t.source+'" model="'+f+'" label="'+l+'"  key="'+c+'" can-create="'+d+'" flatten="'+m+'" queryable="'+g+'" placeholder="'+r+'" on-focus="'+i+'.hasFocus=true" on-blur="'+i+'.hasFocus=false"'+v+"></div>";break;case"textarea":h+='<textarea name="'+a+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" '+(t.required?"required":"")+' rows="'+(t.rows?t.rows:"1")+'"'+s+"></textarea>";break;case"datetime-local":r==o?r="yyyy-MM-ddTHH:mm:ss":null,h+='<input name="'+a+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="datetime-local"'+(t.required?" required":"")+(t.readonly?" readonly":"")+s+">";break;case"password":h+='<input name="'+a+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="password" ng-minlength="6" '+(t.required?"required":"")+s+">";break;case"email":h+='<input name="'+a+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="email" '+(t.required?"required":"")+s+">";break;case"number":h+='<input name="'+a+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="text"'+(t.required?" required":"")+(t.readonly?" readonly":"")+s+' validate-type="number">';break;case"text":default:h+='<input name="'+a+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="text"'+(t.required?" required":"")+(t.readonly?" readonly":"")+s+">"}return h+"</div>"},link:function(e,t,n,o){}}}]),app.directive("controlAutocomplete",["$parse","$window","$timeout",function(e,t,n){var o=5;return{restrict:"A",scope:{service:"=controlAutocomplete",canCreate:"=",flatten:"=",queryable:"=",model:"=",label:"@",key:"@"},template:function(e,t){var n="<div>";return n+='   <input class="form-control" ng-model="phrase" ng-model-options="{ debounce: 150 }" placeholder="'+t.placeholder+'" type="text" ng-focus="onFocus()">',n+='   <ul class="form-autocomplete" ng-show="items.length">',n+='       <li ng-repeat="item in items" ng-class="{ active: active == $index }" ng-click="onSelect(item)">',n+='           <span>{{item.NameA}}<span class="token">{{item.NameB}}</span>{{item.NameC}}</span>',n+="       </li>",n+="   </ul>",n+="</div>"},link:function(r,a,i,s){function u(){return r.model?r.flatten?r.model:r.model[T]:null}function l(e){r.items.length=0,r.count=0,r.phrase=e||null,q.val(r.phrase)}function c(){var e=null;return-1!=r.active&&r.items.length>r.active&&(e=r.items[r.active]),e}function f(e){r.canCreate&&(r.flatten?C===T&&(r.model=e):(r.model={},r.model[T]=e))}function h(){var e=c();e&&r.onSelect(e),r.$apply()}function p(){r.active--,r.active<0&&(r.active=r.items.length-1),r.$apply()}function d(){r.active++,0==r.items.length?r.active=-1:r.active>=r.items.length&&(r.active=0),r.$apply()}function m(e){r.items=e.items,r.count=e.count,angular.forEach(r.items,function(e,t){var n=e[T],o=n.toLowerCase().indexOf(r.phrase.toLowerCase());e.NameA=n.substr(0,o),e.NameB=n.substr(o,r.phrase.length),e.NameC=n.substr(o+r.phrase.length,n.length-(o+r.phrase.length))})}function g(e){var t=0,n=[];r.phrase.length>1&&angular.forEach(e.items,function(e,a){var i=e[T];-1!==i.toLowerCase().indexOf(r.phrase.toLowerCase())&&(n.length<o&&n.push(e),t++)}),m({count:t,items:n})}function v(){r.phrase=q.val(),r.active=-1,f(r.phrase),r.queryable?r.service.setPhrase(r.phrase).then(function(e){r.items=e.items,r.count=e.count},function(e){console.log("Search.queryable.error",r.phrase,e)})["finally"](function(){}):(g({count:r.service.length,items:r.service}),r.$apply())}function y(e){switch(e.keyCode){case 9:case 13:if(h(),r.items.length)return e.preventDefault?e.preventDefault():null,!1;break;case 38:p();break;case 40:d()}}function b(e){switch(e.keyCode){case 9:case 13:break;case 39:break;case 37:break;case 38:break;case 40:break;default:v.call(this)}}function w(e){return null===Utils.getClosest(e.target,"[control-autocomplete]")&&r.$apply(function(){r.onBlur()}),!0}function x(){q.on("keydown",y),q.on("keyup",b),angular.element(t).on("mouseup touchend",w)}function k(){q.off("keydown",y),q.off("keyup",b),angular.element(t).off("mouseup touchend",w)}function $(){P||(x(),P=!0)}var S=e(i.onSelected),q=a.find("input"),T=r.label?r.label:"name",C=r.key?r.key:"id";r.phrase=u(),r.count=0,r.items=[],r.active=-1,r.maxItems=r.maxItems||Number.POSITIVE_INFINITY,r.onFocus=function(){void 0!==i.onFocus&&r.$parent.$eval(i.onFocus),q.val()===u()&&q.val(null)},r.onBlur=function(){void 0!==i.onBlur&&r.$parent.$eval(i.onBlur),l(u())},r.onSelect=function(e){r.queryable?r.service.setItem(e).then(function(e){S({$item:e},r.$parent,{$event:{}}),n(function(){r.flatten?r.model=e[C]:(r.model=r.model||{},angular.extend(r.model,e)),r.onBlur()},1)}):(S({$item:e},r.$parent,{$event:{}}),r.flatten?r.model=e[C]:(r.model=r.model||{},angular.extend(r.model,e)),r.onBlur())},r.$on("$destroy",function(){k()});var P=!1;r.$watch("service",function(e){e&&(e.length||r.queryable)&&$()}),r.$watchCollection("model",function(e){e&&(r.flatten&&T===C?(r.phrase=e,q.val(r.phrase)):e[T]&&(r.phrase=e[T],q.val(r.phrase)))})}}}]),app.directive("scrollable",["$parse","$compile","$window","$timeout","Utils",function(e,t,n,o,r){return{restrict:"A",link:function(o,a,i,s){function u(){q||W&&(q=!0,o.$apply(W).then()["finally"](function(){O=j=0,setTimeout(function(){c(),q=!1},500)}))}function l(){q||A&&(q=!0,o.$apply(A).then()["finally"](function(){var e=a[0].offsetHeight-U[0].offsetHeight;O=j=e>D?D:D+N,setTimeout(function(){c(),q=!1},500)}))}function c(){$=!1,S=!1,C=null,T=null,k()}function f(){E+=N,D-=N,j>E?u():D>j&&l()}function h(e){if(E=0,D=a[0].offsetHeight-U[0].offsetHeight,$?(j=O+C.y-T.y,f()):B&&(j+=B,B*=.75,S&&f(),Math.abs(B)<.05&&(B=0,j=O=z,S=!1,d())),j=Math.min(E,j),j=Math.max(D,j),z+=(j-z)/4,V.transform("translate3d(0,"+z.toFixed(2)+"px,0)"),V.set(U[0]),I){if($||S||B){var t=z/(a[0].offsetHeight-U[0].offsetHeight);t=Math.max(0,Math.min(1,t)),L=(a[0].offsetHeight-Y[0].offsetHeight)*t,H+=(0-H)/4;var n=Math.max(1,Math.round(t*I.rows.length));Y.html(n+"/"+I.count)}else H+=(45-H)/4;J.transform("translate3d("+H.toFixed(2)+"px,"+L.toFixed(2)+"px,0)"),J.set(Y[0])}}function p(){function e(t){h(t),M=window.requestAnimationFrame(e,a)}M||e()}function d(){M&&(window.cancelAnimationFrame(M),M=null)}function m(e){q||(O=j=z,B=0,T=r.getTouch(e),S=!1,x(),p())}function g(e){P=C,C=r.getTouch(e),$=!0}function v(e){C&&P&&(B+=4*(C.y-P.y)),O=j=z,$=!1,C=null,T=null,P=null,F=r.getTouch(e),k()}function y(e){if(!q){e||(e=event);var t=e.deltaY<0||e.wheelDelta>0||e.deltaY<0?1:-1;B+=5*t,S=!0,p()}}function b(){a.on("touchstart mousedown",m),a.on("wheel",R)}function w(){a.off("touchstart mousedown",m),a.off("wheel",R)}function x(){angular.element(n).on("touchmove mousemove",g),angular.element(n).on("touchend mouseup",v)}function k(){angular.element(n).off("touchmove mousemove",g),angular.element(n).off("touchend mouseup",v)}n.ondragstart=function(){return!1};var $,S,q,T,C,P,F,M,W,A,I,N=150,O=0,j=0,z=0,E=0,D=0,B=0,H=45,L=0;void 0!==i.onTop&&(W=e(i.onTop,null,!0)),void 0!==i.onBottom&&(A=e(i.onBottom,null,!0)),void 0!==i.showIndicatorFor&&(I=o.$eval(i.showIndicatorFor)),a.attr("unselectable","on").addClass("unselectable");var J,U=a.find("div"),V=new r.Style,Y=null;I&&(Y=angular.element('<div class="indicator"></div>'),J=new r.Style,a.append(Y),t(Y.contents())(o),J.transform("translate3d("+H.toFixed(2)+"px,"+L.toFixed(2)+"px,0)"),J.set(Y[0]));var R=r.throttle(y,25);o.$on("$destroy",function(){w()}),b()}}}]),app.directive("ngImg",["$parse","$timeout",function(e,t){return{restrict:"A",link:function(t,n,o,r){var a=e(o.ngImg,null,!0),i=new Image;i.onload=function(){o.$set("src",this.src),setTimeout(function(){n.addClass("loaded")},10)},i.load=function(e){n.removeClass("loaded"),this.src=e},t.$watch(a,function(e){e?i.load(e):o.$set("src",null)})}}}]),app.directive("ngImgWorker",["$parse","WebWorker",function(e,t){var n=new t("/js/ws-utils/workers/loader.js");return{restrict:"A",link:function(e,t,o,r){function a(e){function r(e){o.$set("src",e),setTimeout(function(){t.addClass("loaded")},100)}t.removeClass("loaded"),n.post({url:e}).then(function(e){r(e.url)},function(e){r(null)})}var i=e.$eval(o.ngImgWorker);i?a(i):o.$set("src",null)}}}]),app.factory("Vector",function(){function e(e,t){this.x=e||0,this.y=t||0}return e.make=function(t,n){return new e(n.x-t.x,n.y-t.y)},e.size=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.normalize=function(t){var n=e.size(t);return t.x/=n,t.y/=n,t},e.incidence=function(e,t){var n=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);return n},e.distance=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},e.cross=function(e,t){return e.x*t.y-e.y*t.x},e.difference=function(t,n){return new e(n.x-t.x,n.y-t.y)},e.prototype={size:function(){return e.size(this)},normalize:function(){return e.normalize(this)},incidence:function(t){return e.incidence(this,t)},cross:function(t){return e.cross(this,t)},towards:function(e,t){return t=t||.125,this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},friction:function(e){return this.x*=e,this.y*=e,this},copy:function(t){return new e(this.x,this.y)},toString:function(){return"{"+this.x+","+this.y+"}"}},e}),app.factory("Utils",["Vector",function(e){function t(t,n){var o=new e;if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var r=null,a=t.originalEvent?t.originalEvent:t,i=a.touches.length?a.touches:a.changedTouches;i&&i.length&&(r=i[0]),r&&(o.x=r.pageX,o.y=r.pageY)}else"click"!=t.type&&"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(o.x=t.pageX,o.y=t.pageY);return n&&(o.s=e.difference(n,o)),o.type=t.type,o}function n(t,n){var o=t[0].getBoundingClientRect(),r=new e(o.left,o.top);return e.difference(r,n)}function o(e,t){var n,o;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]?(n=e,!0):!1});null!==e;){if(o=e.parentElement,null!==o&&o[n](t))return o;e=o}return null}function r(e,t,n){var o,r,a,i=null,u=0;n||(n={});var l=function(){u=n.leading===!1?0:s(),i=null,a=e.apply(o,r),i||(o=r=null)};return function(){var c=s();u||n.leading!==!1||(u=c);var f=t-(c-u);return o=this,r=arguments,0>=f||f>t?(i&&(clearTimeout(i),i=null),u=c,a=e.apply(o,r),i||(o=r=null)):i||n.trailing===!1||(i=setTimeout(l,f)),a}}function a(){}!function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var o=(new Date).getTime(),r=Math.max(0,16-(o-e)),a=window.setTimeout(function(){t(o+r)},r);return e=o+r,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var i=function(){var e="transform",t="webkitTransform",n=document.createElement("DIV");return"undefined"!=typeof n.style[e]?["webkit","moz","o","ms"].every(function(t){var o="-"+t+"-transform";return"undefined"!=typeof n.style[o]?(e=o,!1):!0}):e="undefined"!=typeof n.style[t]?"-webkit-transform":void 0,e}(),s=Date.now||function(){return(new Date).getTime()},u=function(){function e(){this.props={scale:1,hoverScale:1,currentScale:1}}return e.prototype={set:function(e){var t=[];angular.forEach(this,function(e,n){"props"!==n&&t.push(n+":"+e)}),e.style.cssText=t.join(";")+";"},transform:function(e){this[a.transformProperty]=e},transformOrigin:function(e,t){this[a.transformProperty+"-origin-x"]=Math.round(1e3*e)/1e3+"%",this[a.transformProperty+"-origin-y"]=Math.round(1e3*t)/1e3+"%"}},e}();return a.transformProperty=i,a.getTouch=t,a.getRelativeTouch=n,a.getClosest=o,a.throttle=r,a.Style=u,a}]),app.factory("DataFilter",[function(){function e(e){e?angular.extend(this,e):null}return e.prototype={getSearchParams:function(e){var t=[];if(e)for(var n in e)t.push({name:n,value:e[n]});return t},getParams:function(e,t){var n,o={};for(var r in this)"dateFrom"===r||"dateTo"===r||"status"===r?(n=this[r],void 0!==n&&(o[r]=n)):"search"===r&&(o[r]=JSON.stringify(this.getSearchParams(this[r]),null,""));return o.page=e.page,o.size=e.size,o.infinite=t,o}},e}]),app.factory("DataSource",["$q","$http","$httpAsync","$timeout","$rootScope","DataFilter",function(e,t,n,o,r,a){function i(e){this.busy=!1,this.error=!1,this.size=10,this.maxPages=10,this.rows=[],this.filters={},this.service={url:"/api/items/paging",resolve:function(e,t){angular.forEach(e,function(e){this.push(e)},t)}},e?angular.extend(this,e):null,this.filters=new a(this.filters),this.service.uri.paging===!1&&(this.get=function(e,t){this.busy=!0,this.error=!1,o(function(){t?null:this.rows.length=0,this.service.resolve(this.rows),this.page=1,this.pages=2,this.count=this.rows.length,this.pagination=this.getPages(),this.busy=!1,r.$broadcast("onDataSourceUpdate",this),e.resolve(this.rows)}.bind(this),1e3)}),this.flush()}var s=Number.POSITIVE_INFINITY;return i.prototype={flush:function(){this.pages=s,this.page=1,this.count=0,this.opened=null},resolve:function(e){var t=e.headers("X-Pagination"),n=t?JSON.parse(t):null;n?(this.page=n.page,this.size=n.size,this.pages=n.pages,this.count=n.count):(this.page=0,this.size=n.size,this.pages=0,this.count=0),this.pagination=this.getPages()},get:function(e,t){this.busy=!0,this.error=!1,n.get(this.service.uri.paging,{params:this.filters.getParams(this)}).then(function(n){this.resolve(n),t?null:this.rows.length=0,this.service.resolve(n.data,this.rows),r.$broadcast("onDataSourceUpdate",this),e.resolve(this.rows)}.bind(this),function(t){console.log("error.response",t),this.error=!0,e.reject(t)}.bind(this))["finally"](function(){o(function(){this.busy=!1}.bind(this),1e3)}.bind(this))},paging:function(){var t=e.defer();return this.busy||this.page>this.pages?t.reject():(this.opened=null,this.get(t)),t.promise},refresh:function(){var t=e.defer();return this.busy?t.reject():(this.flush(),this.get(t)),t.promise},more:function(){var t=e.defer();return this.busy||this.page+1>this.pages?t.reject():(this.page++,this.get(t,!0)),t.promise},filter:function(){this.page=1,this.pages=s,this.paging()},prevPage:function(){var e=this.page-1;e>0&&e<=this.pages&&(this.page=e,this.paging())},nextPage:function(){var e=this.page+1;e>0&&e<=this.pages&&(this.page=e,this.paging())},gotoPage:function(e){e>0&&e<=this.pages&&(this.page=e,this.paging())},firstPage:function(){1!==this.page&&(this.page=1,this.paging())},lastPage:function(){this.page!==this.pages&&(this.page=this.pages,this.paging())},hasMany:function(){return this.count>0&&this.pages>this.maxPages},hasMorePagesBehind:function(){var e=Math.max(0,this.page-this.maxPages);return e>0},hasMorePagesNext:function(){var e=Math.max(0,this.page-this.maxPages)+this.maxPages;return e<this.pages},isPage:function(e){return this.page===e},hasPages:function(){return this.pages>0&&this.pages<s},getPages:function(){var e,t=[];if(this.hasPages()){var n=Math.max(0,this.page-this.maxPages),o=Math.min(this.pages,n+this.maxPages);for(e=n;o>e;)t.push({number:e+1}),e++}return t},openClose:function(e){this.opened===e?this.opened=null:this.opened=e}},i}]),app.factory("LocalStorage",["$http","$q","$window",function(e,t,n){function o(){}function r(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}return o.isSupported=r(),o.isSupported||console.log("LocalStorage.unsupported"),o.set=function(e,t){if(this.isSupported)try{var o=[],r=JSON.stringify(t,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==o.indexOf(t))return;o.push(t)}return t}});o=null,n.localStorage.setItem(e,r)}catch(a){console.log("LocalStorage.set.error serializing",e,t,a)}},o.get=function(e){if(this.isSupported){var t=null;if(void 0!==n.localStorage[e])try{t=JSON.parse(n.localStorage[e])}catch(o){console.log("LocalStorage.get.error parsing",e,o)}return t}},o.onStorage=function(){console.log("LocalStorage.onStorage",arguments)},angular.element(n).on("storage",o.onStorage),o}]),app.factory("WebWorker",["$q","$http",function($q,$http){function WebWorker(e){var t=this;this.callbacks={},this.id=0,this.worker=new Worker(e),this.worker.onmessage=function(e){t.onmessage(e)}}var isWebWorkerSupported="undefined"!=typeof Worker;return isWebWorkerSupported||(window.Worker=function(){function Worker(src){var self=this;$http.get(src,{transformResponse:function(e,t){return e}}).then(function success(response){try{eval("self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\n "+response.data+" };"),self.object=new self.o,self.object.postMessage=function(e){self.onmessage({data:e})}}catch(e){console.log("Worker error ",e)}},function(e){console.log("Worker not found")})}return Worker.prototype={onmessage:function(e){console.log("Worker not implemented")},postMessage:function(e){this.object.onmessage({data:e})}},Worker}()),WebWorker.prototype={parse:function(e){return JSON.parse(e.data)},stringify:function(e){return JSON.stringify(e)},onmessage:function(e){var t=this.parse(e),n=this.callbacks[t.id];-1!==t.status?n.resolve(t):n.reject(t),delete this.callbacks[t.id]},post:function(e){var t=$q.defer();return e.id=this.id,this.callbacks[this.id.toString()]=t,this.id++,this.worker.postMessage(this.stringify(e)),t.promise}},WebWorker.isSupported=isWebWorkerSupported,WebWorker}]),app.factory("$httpAsync",["$q","$http",function(e,t){function n(t){var o=e.defer(),r=u(t);return r.id=h.toString(),console.log("wrap",r),f[r.id]=o,h++,c.postMessage(n.stringify(r)),o.promise}function o(e){return e>=200&&300>e}function r(){return Object.create(null)}function a(e){return"string"==typeof e}function i(e){function t(e,t){e&&(o[e]=o[e]?o[e]+", "+t:t)}var n,o=r();if(a(e))for(var i=e.split("\n"),s=0;s<i.length;s++){var u=i[s];n=u.indexOf(":"),t(p(d(u.substr(0,n))),d(u.substr(n+1)))}else if(isObject(e))for(var l in e)t(p(l),d(e[l]));return o}function s(e){var t;return function(n){if(t||(t=i(e)),n){var o=t[p(n)];return void 0===o&&(o=null),o}return t}}function u(e){var n={method:"GET",withCredentials:!1,responseType:"json",headers:{},config:{}};n.withCredentials=t.defaults.withCredentials,angular.extend(n.headers,t.defaults.headers.common);var o=(e.method||n.method).toLowerCase();return t.defaults.headers[o]&&angular.extend(n.headers,t.defaults.headers[o]),console.log("defaults",t.defaults),e?e=angular.extend(n,e):n,e}var l="undefined"!=typeof Worker;if(!l)return t;var c=new Worker("/js/workers/http.js"),f={},h=0,p=function(e){return a(e)?e.toLowerCase():e},d=function(e){return a(e)?e.trim():e};return n.get=function(e,t){return n(angular.extend({},t||{},{method:"GET",url:e}))},n["delete"]=function(e,t){return n(angular.extend({},t||{},{method:"DELETE",url:e}))},n.head=function(e,t){return n(angular.extend({},t||{},{method:"HEAD",url:e}))},n.post=function(e,t,o){return n(angular.extend({},o||{},{method:"POST",data:t,url:e}))},n.put=function(e,t,o){return n(angular.extend({},o||{},{method:"PUT",data:t,url:e}))},n.patch=function(e,t,o){return n(angular.extend({},o||{},{method:"PATCH",data:t,url:e}))},n.parse=function(e){return JSON.parse(e.data)},n.stringify=function(e){return JSON.stringify(e)},n.isSupported=l,c.onmessage=function(e){var t=n.parse(e);console.log("onmessage",t);var r=f[t.id],a=t.status>=-1?t.status:0,i=s(t.response.headers);(o(a)?r.resolve:r.reject)({data:t.response.data,headers:i,status:t.response.status,statusText:t.response.statusText,config:t.config}),delete f[t.id]},n}]),app.controller("TestCtrl",["$scope","$location","$timeout","DataSource","DishesTest",function(e,t,n,o,r){e.filters={search:{}},e.source=new o({service:r,filters:e.filters}),n(function(){e.source.paging()},1e3)}]);
//# sourceMappingURL=ws-utils.min.js.map
